<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MacrOs</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
body { font-family: 'SF Pro', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f5f5f7; color: #000; margin: 20px; transition: all 0.3s; }
header { text-align: center; font-size: 2.5rem; font-weight: 700; margin-bottom: 15px; color: #000; }
.top-buttons { display: flex; justify-content: center; gap: 10px; margin-bottom: 25px; }
.top-buttons button { background: #28a745; color: white; border: none; padding: 8px 14px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 5px; border-radius: 8px; transition: 0.2s; }
.top-buttons button:hover { background: #218838; }

/* Layout dos columnas */
main { display: flex; gap: 20px; flex-wrap: wrap; }
.left-column { flex: 1; min-width: 350px; display: flex; flex-direction: column; gap: 15px; }
.right-column { flex: 1; min-width: 350px; }

/* Quick Notes Card */
.quick-card { background:#fff; border-radius:8px; padding:12px; width:100%; box-shadow: 0 6px 15px rgba(0,0,0,0.08); margin:0; transition: all 0.3s ease; }
.quick-card-header { display:flex; justify-content:space-between; align-items:center; }
.quick-card-header h3 { margin:0; }
.quick-toggle-btn { background:#28a745; color:#fff; border:none; border-radius:50%; width:30px; height:30px; cursor:pointer; font-weight:bold; }
.quick-toggle-btn:hover { background:#218838; }
.quick-buttons, .sub-buttons { display:flex; flex-wrap: wrap; gap:5px; margin-top:5px; justify-content: center; }
.quick-btn, .sub-btn { background:#007bff; color:#fff; border:none; border-radius:6px; padding:6px 10px; cursor:pointer; font-weight:bold; }
.quick-btn:hover, .sub-btn:hover { background:#0056d6; }

/* Manage quick notes */
.manage-quick { margin-top:12px; border-top:1px solid #eee; padding-top:10px; }
.manage-quick input, .manage-quick textarea { padding:6px; margin-bottom:6px; font-family:'SF Pro', sans-serif; }
.manage-quick button { background:#007bff; color:#fff; border:none; padding:6px 8px; border-radius:6px; cursor:pointer; }

/* Form Card */
.card { background:#fff; padding:20px; border-radius:8px; box-shadow: 0 6px 15px rgba(0,0,0,0.08); }
label { font-weight:600; margin:10px 0 5px; text-transform: capitalize; }
input, select, textarea { width:100%; box-sizing:border-box; padding:8px 12px; margin-bottom:12px; border-radius:6px; border:1px solid #ccc; background:#f2f2f7; font-size:0.95rem; color: #000; font-family:'SF Pro', sans-serif; }
textarea { resize: vertical; }

/* CEX buttons */
.cex-buttons { display:flex; gap:8px; justify-content:center; margin-bottom:10px; }
.cex-buttons button { flex:1; color:#fff; border:none; padding:6px; border-radius:6px; font-weight:bold; cursor:pointer; max-width: 120px; font-family:'SF Pro', sans-serif; }
.cex-good { background:#34c759; } .cex-neutral { background:#ff9500; } .cex-bad { background:#ff3b30; }

/* Output */
.output { display:flex; flex-direction:column; }
.output textarea { width:100%; min-height:400px; border-radius:6px; padding:12px; margin-bottom:5px; background:#f2f2f7; font-family:monospace; font-size:0.95rem; color: #000; }
.copy-container { display:flex; justify-content:flex-end; gap:5px; }
.copy-container button { background:#28a745; color:white; border:none; padding:6px 12px; cursor:pointer; display:flex; align-items:center; gap:5px; border-radius:6px; }
.copy-container button:hover { background:#218838; }

/* Dark mode */
body.dark { background:#121212; color:white; }
body.dark header { color:#fff; }
body.dark .card, body.dark .quick-card { background:#1e1e1e; border:1px solid #444; box-shadow:none; color:#fff; }
body.dark input, body.dark select, body.dark textarea { background:#2a2a2a; color:white; border:1px solid #555; }
body.dark .copy-container button, body.dark .top-buttons button { border:1px solid #fff; background:none; color:white; }
body.dark .cex-buttons button { color:#fff; }
body.dark .quick-card-header h3 { color:#fff; }
body.dark #historyPanel { background:#2c2c2c; color:white; }

/* History Panel + Backdrop */
#historyBackdrop { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:999; opacity:0; transition:opacity 0.3s; }
#historyBackdrop.active { display:block; opacity:1; }
#historyPanel { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%) scale(0.9); width:420px; max-height:75%; overflow-y:auto; z-index:1000; background:#e0e0e0; border-radius:6px; box-shadow:0 0 20px rgba(0,0,0,0.4); padding:20px; opacity:0; transition:all 0.25s ease; }
#historyPanel.active { display:block; opacity:1; transform:translate(-50%,-50%) scale(1); }
#historyPanel h3 { margin-top:0; text-align:center; }
#historyPanel ul { list-style:none; padding:0; margin:0; }
#historyPanel li { padding:8px 10px; margin-bottom:6px; background:#f5f5f5; border-radius:4px; cursor:pointer; transition: background 0.2s; }
#historyPanel li:hover { background:#ccc; }
#clearHistoryBtn { width:100%; padding:6px; border:none; border-radius:6px; cursor:pointer; font-weight:bold; margin-top:10px; background:#ff3b30; color:white; }
#closeHistoryBtn { width:100%; padding:6px; border:none; border-radius:6px; cursor:pointer; font-weight:bold; margin-top:10px; background:#007bff; color:white; }

/* Undo */
#undoBtn { background:#34c759; color:white; border:none; padding:6px 12px; cursor:pointer; border-radius:6px; display:none; }

/* responsive tweaks */
@media (max-width:900px){ main{flex-direction:column;} #historyPanel{width:90%;}}
</style>
</head>
<body>
<header>MacrOs</header>

<div class="top-buttons">
  <button onclick="newCall()"><i class="fas fa-plus"></i> New Call</button>
  <button onclick="toggleHistoryPanel()"><i class="fas fa-history"></i> History</button>
  <button id="darkModeBtn"><i class="fas fa-moon"></i> Dark Mode</button>
</div>

<main>
  <div class="left-column">
    <div class="quick-card" id="quickNotesCard">
      <div class="quick-card-header">
        <h3>Quick Notes</h3>
        <div style="display:flex;gap:8px;align-items:center;">
          <button id="manageQuickToggle" class="quick-toggle-btn" title="Manage Quick Notes">âš™</button>
          <button id="toggleQuickNotes" class="quick-toggle-btn">+</button>
        </div>
      </div>
      <div class="quick-buttons" id="quickCategories" style="display:none;"></div>
      <div class="sub-buttons" id="subOptions" style="display:none;"></div>
      <div class="manage-quick" id="manageQuick" style="display:none;">
        <label>Add Quick Note</label>
        <input id="mqCategory" placeholder="Category (e.g. Shipping)" />
        <input id="mqTitle" placeholder="Title (e.g. Delayed)" />
        <textarea id="mqInquiry" placeholder="Inquiry text"></textarea>
        <textarea id="mqAction" placeholder="Action taken text"></textarea>
        <div style="display:flex;gap:8px;align-items:center;">
          <button id="addQuickBtn">Add</button>
          <select id="mqDeleteSelect" style="flex:1;"></select>
          <button id="deleteQuickBtn" style="background:#ff3b30;">Delete</button>
        </div>
      </div>
    </div>

    <div class="card" id="formCard">
      <form id="macroForm">
        <label for="brand">Brand</label>
        <select id="brand" onchange="updateNotes()"></select>

        <label for="contactType">Contact Type</label>
        <select id="contactType" onchange="updateContactLabel(); updateNotes()">
          <option value="Phone">Phone</option>
          <option value="Ticket">Ticket</option>
        </select>

        <label id="contactFormLabel" for="contactForm">Phone</label>
        <input type="text" id="contactForm" placeholder="Phone #" />

        <label for="name">Name</label>
        <input type="text" id="name" placeholder="Customer Name" />

        <label for="orderNumber">Order Number</label>
        <input type="text" id="orderNumber" placeholder="Order Number" />

        <label for="inquiry">Inquiry</label>
        <textarea id="inquiry" placeholder="Inquiry"></textarea>

        <label for="actionTaken">Action Taken</label>
        <textarea id="actionTaken" placeholder="Action Taken"></textarea>

        <label>Customer Experience (CEX)</label>
        <div class="cex-buttons">
          <button type="button" class="cex-good" onclick="selectCEX('Good')"><i class="fas fa-thumbs-up"></i> Good</button>
          <button type="button" class="cex-neutral" onclick="selectCEX('Neutral')"><i class="fas fa-meh"></i> Neutral</button>
          <button type="button" class="cex-bad" onclick="selectCEX('Bad')"><i class="fas fa-thumbs-down"></i> Bad</button>
        </div>

        <label for="cexReason">Reason</label>
        <select id="cexReason" onchange="updateWhy()"></select>

        <label for="cexWhy">Why</label>
        <select id="cexWhy" onchange="updateNotes()"></select>
      </form>
    </div>
  </div>

  <div class="right-column">
    <div class="card output">
      <label for="notes">Generated Notes</label>
      <textarea id="notes" readonly></textarea>
      <div class="copy-container">
        <button id="copy-btn" onclick="copyNotes()"><i class="far fa-copy"></i> Copy and Save</button>
        <button onclick="clearForm()">Clear</button>
        <button id="undoBtn" onclick="undoClear()">Undo</button>
      </div>
    </div>
  </div>
</main>

<div id="historyBackdrop"></div>
<div id="historyPanel">
  <h3>Call History</h3>
  <input type="text" id="historySearch" placeholder="Search by name/order..." oninput="renderHistory()" style="width:100%; padding:6px; margin-bottom:10px; border-radius:6px; border:1px solid #bbb;">
  <ul id="historyList"></ul>
  <button id="clearHistoryBtn" onclick="clearHistory()">Clear History</button>
  <button id="closeHistoryBtn" onclick="toggleHistoryPanel()">Close</button>
</div>

<script>
// Brand list
const brands = ["AirDoctor","AquaTru"];
const brandSelect = document.getElementById("brand");
brands.forEach(b=>brandSelect.add(new Option(b,b)));

// Contact label change
function updateContactLabel(){
  const label = document.getElementById("contactFormLabel");
  label.innerText = document.getElementById("contactType").value=="Phone"?"Phone":"Ticket";
}

// CEX Options
let cexReasons = {
  Good:["Customer was satisfied with the information provided","Clear and Fast resolution was achieved","Customer understood the process or instructions","Interaction was friendly and professional","Empathy and proactive was provided","Customer appreciated the attention and information given","Courtesy item or discount was offered","Refund, replacement, or order was processed successfully","Clear next steps were explained to the customer","Customer was polite and cooperative during the interaction"],
  Neutral:["No customer response yet, awaiting action or reply","Outcome still pending, more information or steps required","Awaiting internal confirmation such as tracking, refund, or backoffice review","Neutral attitude expresses no strong emotion"],
  Bad:["Customer was frustrated or dissatisfied with support","Issue persisted even after troubleshooting efforts","Product was defective or not working properly","Shipping or delivery delays caused frustration","Customer was unhappy with assessment or reluctant to troubleshoot","Customer was unhappy with refund or credit amount offered","Long wait time or lack of promised callback caused dissatisfaction","Filter life or product quality concerns led to frustration"]
};
let cexWhy = {...cexReasons};

// Fill reason dropdown
function fillCEXOptions(){
  const reasonSel = document.getElementById("cexReason");
  reasonSel.innerHTML="";
  const cex = window.selectedCEX||"Good";
  cexReasons[cex].forEach(r=>reasonSel.add(new Option(r,r)));
  updateWhy();
}

// Fill why dropdown
function updateWhy(){
  const reason = document.getElementById("cexReason").value;
  const whySel = document.getElementById("cexWhy");
  whySel.innerHTML="";
  whySel.add(new Option(reason,reason));
  updateNotes();
}

function selectCEX(cex){ window.selectedCEX=cex; fillCEXOptions(); updateNotes(); }

// Generate notes
function updateNotes(){
  const brand = document.getElementById("brand").value;
  const contactType = document.getElementById("contactType").value;
  const contactForm = document.getElementById("contactForm").value;
  const name = document.getElementById("name").value;
  const orderNumber = document.getElementById("orderNumber").value;
  const inquiry = document.getElementById("inquiry").value;
  const actionTaken = document.getElementById("actionTaken").value;
  const cex = window.selectedCEX||"";
  const why = document.getElementById("cexWhy").value;
  document.getElementById("notes").value=
    `Brand: ${brand} | Contact via: ${contactType} ${contactForm} | Name: ${name} | Order#: ${orderNumber} | Inquiry: ${inquiry} | Action Taken: ${actionTaken} | CEX: ${cex} | Why: ${why}`;
}

// Copy notes
function copyNotes(){ navigator.clipboard.writeText(document.getElementById("notes").value).then(()=>alert("Copied!")); }

// Form management
function clearForm(){ window.prevNotes=document.getElementById("notes").value; document.getElementById("macroForm").reset(); updateNotes(); document.getElementById("undoBtn").style.display="inline-block"; }
function undoClear(){ if(window.prevNotes) document.getElementById("notes").value=window.prevNotes; document.getElementById("undoBtn").style.display="none"; }

// History panel
function toggleHistoryPanel(){ document.getElementById("historyBackdrop").classList.toggle("active"); document.getElementById("historyPanel").classList.toggle("active"); }
function newCall(){ clearForm(); toggleHistoryPanel(); }

// Initial load
fillCEXOptions();
updateNotes();
</script>
</body>
</html>
