<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Veronica Sale Mag - By MarcOS corp.</title>
<style>
  :root{
    --bg-rice:#FDF83;
    --card-hazelnut:#F3EBDF;
    --card-gray:#f2f2f4;
    --accent:#148D8D; /* botones */
    --text:#111;
    --muted:#666;
    --chip-border:#148D8D;
    --shadow: 0 6px 18px rgba(0,0,0,0.08);
  }
  html,body{height:100%;margin:0;font-family:Inter, system-ui, Arial, sans-serif;background:var(--bg-rice);color:var(--text)}
  header{display:flex;flex-direction:column;align-items:center;gap:8px;padding:18px}
  header h1{font-family:'Fortune Works', Georgia, serif;font-weight:700;margin:0;font-size:20px;color:#000}
  .nav{display:flex;gap:16px;align-items:center}
  .nav button{background:transparent;border:none;padding:8px 14px;border-radius:8px;font-weight:600;cursor:pointer}
  .nav button.primary{background:var(--accent);color:#fff}

  /* layout */
  .wrap{display:flex;gap:18px;padding:12px;max-width:1200px;margin:0 auto}
  .left,.right{flex:1;display:flex;flex-direction:column;gap:12px}

  .card{background:var(--card-hazelnut);border-radius:12px;padding:12px;box-shadow:var(--shadow);}
  .card.gray{background:var(--card-gray)}
  .card .title{font-family:'Fortune Works', Georgia, serif;font-weight:700;margin-bottom:8px}

  /* Brands buttons */
  .brands{display:flex;flex-wrap:wrap;gap:8px}
  .brand-btn{background:var(--accent);color:#fff;border-radius:10px;padding:8px 12px;border:2px solid var(--accent);cursor:pointer;transition:all .18s ease}
  .brand-btn:hover{transform:translateY(-3px);box-shadow:0 6px 12px rgba(20,141,141,0.12)}

  /* Panel de llamada */
  .call-panel{min-height:260px}
  textarea{width:100%;min-height:90px;border-radius:10px;padding:8px;border:1px solid #ddd;outline:none;transition:box-shadow .12s}
  textarea:focus{box-shadow:0 0 0 3px rgba(0,0,0,0.08);}
  .controls{display:flex;gap:8px;margin-top:8px}
  .btn{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700;transition:transform .12s}
  .btn:active{transform:scale(.98)}
  .btn.ghost{background:transparent;color:var(--accent);border:2px solid var(--accent)}

  .suggestions{margin-top:8px;display:flex;flex-direction:column;gap:8px}
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{background:#fff;padding:6px 10px;border-radius:999px;border:1px solid #eee}

  /* Registro de ventas */
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border-bottom:1px solid #eee;text-align:left;font-size:13px}
  .right .card.small{padding:8px}

  /* Dashboard */
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
  .big{font-size:20px;font-weight:700}
  .muted{color:var(--muted);font-size:13px}

  /* currency toggle */
  .toggle{display:flex;gap:6px}
  .toggle button{padding:6px 10px;border-radius:8px;border:1px solid #ddd;background:#fff;cursor:pointer}
  .toggle button.active{background:var(--accent);color:#fff;border-color:var(--accent)}

  /* animations focus */
  .focus-outline{transition:box-shadow .18s ease}
  .focus-outline.focus{box-shadow:0 0 0 3px rgba(0,0,0,0.12)}

  /* New order check animation */
  .btn.checking{position:relative}
  .btn.checking .check{position:absolute;right:10px;top:8px;opacity:0;transform:translateY(-6px);transition:all .2s}
  .btn.checked .check{opacity:1;transform:translateY(0)}

  /* hover outline for panel buttons */
  .panel-actions .btn:hover{background:transparent;color:var(--accent);border:1px solid var(--accent)}

  /* Darkmode simple */
  .dark{background:#0b1220;color:#fff}
  .dark .card{background:#11151a}
  .footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px;padding:8px}

  @media(max-width:900px){.wrap{flex-direction:column}}
</style>
</head>
<body>
  <header>
    <h1>Veronica Sale Mag - By MarcOS corp.</h1>
    <div class="nav">
      <button class="primary">Dashboard</button>
      <button id="darkToggle">Darkmode</button>
      <button id="exportBtn">Exportar</button>
    </div>
  </header>

  <main class="wrap">
    <section class="left">
      <div class="card gray call-panel">
        <div class="title">ðŸ“ž Panel de llamada</div>
        <div style="margin-bottom:8px" class="brands" id="brands"></div>
        <div style="margin-top:8px">
          <label class="muted">Estado de la llamada</label>
          <select id="callState" style="width:100%;padding:8px;border-radius:8px;margin-top:6px;border:1px solid #ddd">
            <option value="cold">FrÃ­a</option>
            <option value="warm">Caliente</option>
            <option value="hot">Hot / Interesado</option>
          </select>
        </div>
        <div style="margin-top:8px">
          <label class="muted">Notas (escribe sobre la llamada)</label>
          <textarea id="callNotes" placeholder="Ej: Cliente interesado en AirDoctor pero dice que estÃ¡ caro"></textarea>
        </div>
        <div class="controls">
          <button class="btn" id="analyzeBtn">Analizar llamada â†’ sugerir</button>
          <button class="btn ghost" id="clearBtn">Limpiar</button>
        </div>

        <div id="suggestionsBox" class="suggestions" style="display:none">
          <div><strong>Sugerencias de upsell</strong><div class="chips" id="upsellChips"></div></div>
          <div><strong>Frases para cerrar</strong><div id="closingPhrases"></div></div>
          <div><strong>Objeciones detectadas</strong><div id="objectionsList"></div></div>
          <div style="margin-top:8px" class="panel-actions">
            <button class="btn" id="markNewOrder">New Order âœ“<span class="check">âœ”</span></button>
          </div>
        </div>
      </div>

      <!-- space for extras if needed -->
      <div class="card small" style="min-height:80px">
        <div class="title">Quick actions</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="brand-btn">Reservar talla</button>
          <button class="brand-btn">Enviar link pago</button>
          <button class="brand-btn">Enviar promo</button>
        </div>
      </div>
    </section>

    <aside class="right">
      <div class="card" id="dashboard">
        <div class="title">ðŸ“Š Dashboard â€” Sales by MacrOS</div>
        <div class="grid">
          <div>
            <div class="muted">Total vendido</div>
            <div class="big" id="totalSoldUSD">$0.00</div>
            <div class="muted">USD</div>
          </div>
          <div>
            <div class="muted">Total comisiones</div>
            <div class="big" id="totalCommission">$0.00</div>
            <div class="muted">USD</div>
          </div>
          <div>
            <div class="muted">Ventas (hoy)</div>
            <div class="big" id="salesToday">0</div>
            <div class="muted">Unidades</div>
          </div>
          <div>
            <div class="muted">Tier actual</div>
            <div class="big" id="currentTier">-</div>
            <div class="muted">Nivel</div>
          </div>
        </div>
        <div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center">
          <div class="toggle">
            <button id="usdBtn" class="active">USD</button>
            <button id="copBtn">COP</button>
          </div>
          <div>
            <label class="muted">TRM (USD â†’ COP)</label>
            <input id="trmInput" type="number" value="4000" style="padding:6px;border-radius:8px;border:1px solid #ddd;width:120px" />
          </div>
        </div>
      </div>

      <div class="card small" style="margin-top:12px">
        <div class="title">ðŸ’µ Registro de ventas cerradas (New Order)</div>
        <table id="salesTable"><thead><tr><th>Fecha</th><th>Cliente</th><th>Producto</th><th>Precio USD</th><th>ComisiÃ³n</th><th>Precio COP</th></tr></thead><tbody></tbody></table>
      </div>

      <div class="card small" style="margin-top:12px">
        <div class="title">Ventas por Tier</div>
        <div id="tiersList" class="muted">No hay ventas aÃºn.</div>
      </div>
    </aside>
  </main>

  <footer class="footer card small">
    <div>Random filler: Â© MarcOS corp. Made with love and coffee. Version 0.9</div>
  </footer>

<script>
  // ========== Datos iniciales (placeholder) ========
  const BRANDS = ['AirDoctor','AquaTru','Prosvent','IdealProstate+','BetterBladder','Walkfit','RotoRazer','Superthotics','MiracleBlade'];
  const PRODUCTS = [
    {sku:'P001',name:'AirDoctor Mini',price:199,upsell:['P002'],category:'AirDoctor',desc:'Purificador portÃ¡til'},
    {sku:'P002',name:'AirDoctor Pro',price:349,upsell:[],category:'AirDoctor',desc:'Purificador profesional'},
    {sku:'A100',name:'AquaTru Model X',price:499,upsell:['A110'],category:'AquaTru',desc:'Filtro de agua'},
    {sku:'A110',name:'AquaTru Filter Pack',price:49,upsell:[],category:'AquaTru',desc:'Filtros de reemplazo'}
  ];

  // Commission tiers
  const TIERS = [
    {min:1,max:399,commission:1.65},
    {min:400,max:599,commission:3.30},
    {min:600,max:899,commission:5.00},
    {min:900,max:Infinity,commission:8.30}
  ];

  // localStorage key
  const STORAGE_KEY = 'veronica_sales_v1';

  // populate brands buttons
  const brandsEl = document.getElementById('brands');
  BRANDS.forEach(b=>{
    const btn = document.createElement('button'); btn.className='brand-btn'; btn.textContent=b; btn.dataset.brand=b;
    btn.addEventListener('click',()=>selectBrand(b)); brandsEl.appendChild(btn);
  })

  function selectBrand(b){
    // simple filter: prefill notes area
    document.getElementById('callNotes').value = `Interesado en ${b} â€” `;
    // subtle focus VFX
    document.getElementById('callNotes').classList.add('focus'); setTimeout(()=>document.getElementById('callNotes').classList.remove('focus'),400);
  }

  // Analyze call
  document.getElementById('analyzeBtn').addEventListener('click',()=>{
    const notes = document.getElementById('callNotes').value.toLowerCase();
    const state = document.getElementById('callState').value;
    const suggestionsBox = document.getElementById('suggestionsBox');
    suggestionsBox.style.display='block';

    // detect product mentions by name/brand
    const found = PRODUCTS.filter(p=>notes.includes(p.name.toLowerCase()) || notes.includes(p.category.toLowerCase()));
    const upsellChips = document.getElementById('upsellChips'); upsellChips.innerHTML='';
    let ups = [];
    if(found.length>0){
      found.forEach(f=>{f.upsell.forEach(u=>{const prod = PRODUCTS.find(x=>x.sku===u); if(prod) ups.push(prod)})});
    }
    // fallback: suggest top products in same category
    if(ups.length===0 && found.length>0){
      const cat = found[0].category; ups = PRODUCTS.filter(p=>p.category===cat && p.sku!==found[0].sku).slice(0,3);
    }
    if(ups.length===0) ups = PRODUCTS.slice(0,3);
    ups.forEach(u=>{const s = document.createElement('span'); s.className='chip'; s.textContent = `${u.name} â€” $${u.price}`; upsellChips.appendChild(s)});

    // Closing phrases depending on callState
    const closing = document.getElementById('closingPhrases'); closing.innerHTML='';
    const basePrice = (found[0] && found[0].price) ? found[0].price : ups[0].price;
    const closings = generateClosings(state, basePrice);
    closings.forEach(c=>{const d=document.createElement('div');d.textContent=c;closing.appendChild(d)});

    // objections detection
    const obsList = document.getElementById('objectionsList'); obsList.innerHTML='';
    const knownObjs = ['caro','precio','no necesito','luego','pensarlo','talla'];
    const detected = knownObjs.filter(k=>notes.includes(k));
    if(detected.length===0) detected.push('precio'); // suggest price strategies
    detected.forEach(o=>{const div=document.createElement('div');div.textContent = `${o}: ${objectionResponse(o)}`;obsList.appendChild(div)});
  });

  function generateClosings(state,price){
    if(state==='cold'){
      return [
        `Puedo reservarte una unidad por $${price} y darte 48h para pensarlo. Â¿Te lo reservo?`,
        `Si te interesa puedo enviarte fotos reales y asegurar tu talla hoy.`
      ];
    }
    if(state==='warm'){
      return [
        `Confirmando ahora te lo dejo en $${price} y lo despacho en 24â€“48h. Â¿Procedo?`,
        `Si lo llevas con el filtro extra ahorras $5. Â¿Lo agrego al pedido?`
      ];
    }
    return [
      `Lo dejo listo por $${price} y te bloqueo la unidad ahora mismo. Â¿Confirmas?`,
      `Si confirmas ahora te incluyo envÃ­o priorizado sin costo extra.`
    ];
  }

  function objectionResponse(o){
    const map = {
      'caro':'Entiendo. Podemos ver un combo o promociÃ³n para que te quede mÃ¡s barato; prefieres ahorro o solo la prenda?',
      'precio':'Te puedo ofrecer un plan de pago o un combo con descuento.',
      'no necesito':'Comprendo, Â¿quÃ© problema buscas resolver para recomendarte la mejor opciÃ³n?',
      'luego':'Puedo reservar la unidad 24h para que no pierdas la promo.',
      'pensarlo':'Perfecto, te bloqueo la unidad mientras decides por 2 horas.',
      'talla':'Confirmo existencia y la reservo mientras decides.'
    };
    return map[o] || 'Puedo ofrecer alternativas o un descuento por tiempo limitado.'
  }

  // Mark new order (only then save)
  document.getElementById('markNewOrder').addEventListener('click',()=>{
    const notes = document.getElementById('callNotes').value;
    // naive parse: try find product in notes
    const found = PRODUCTS.find(p=>notes.toLowerCase().includes(p.name.toLowerCase()) || notes.toLowerCase().includes(p.category.toLowerCase()));
    const client = notes.split('â€”')[0].trim() || 'Cliente';
    const date = new Date().toISOString();
    const prod = found || PRODUCTS[0];
    const revenue = prod.price;
    const commission = computeCommission(revenue);
    const trm = Number(document.getElementById('trmInput').value)||4000;
    const revenueCOP = revenue * trm;

    const sale = {date,client,sku:prod.sku,product:prod.name,price:revenue,commission,priceCOP:revenueCOP};
    saveSale(sale);

    // ui feedback
    const btn = document.getElementById('markNewOrder'); btn.classList.add('checking'); setTimeout(()=>{btn.classList.remove('checking');btn.classList.add('checked');},220);
    setTimeout(()=>btn.classList.remove('checked'),1800);
  });

  // storage helpers
  function loadSales(){
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw?JSON.parse(raw):[];
  }
  function saveSale(sale){
    const arr = loadSales(); arr.unshift(sale); localStorage.setItem(STORAGE_KEY,JSON.stringify(arr)); renderSales(); renderDashboard();
  }

  function renderSales(){
    const rows = loadSales(); const tbody = document.querySelector('#salesTable tbody'); tbody.innerHTML='';
    rows.forEach(r=>{
      const tr = document.createElement('tr'); tr.innerHTML = `<td>${new Date(r.date).toLocaleString()}</td><td>${r.client}</td><td>${r.product}</td><td>$${r.price.toFixed(2)}</td><td>$${r.commission.toFixed(2)}</td><td>${r.priceCOP.toFixed(0)}</td>`; tbody.appendChild(tr);
    });
    if(rows.length===0) tbody.innerHTML='<tr><td colspan="6" class="muted">No hay ventas registradas</td></tr>';
  }

  function computeCommission(amount){
    for(const t of TIERS){
      if(amount>=t.min && amount<=t.max) return t.commission;
    }
    return 0;
  }

  function renderDashboard(){
    const rows = loadSales();
    const total = rows.reduce((s,r)=>s + Number(r.price),0);
    const totalCommission = rows.reduce((s,r)=>s + Number(r.commission),0);
    document.getElementById('totalSoldUSD').textContent = `$${total.toFixed(2)}`;
    document.getElementById('totalCommission').textContent = `$${totalCommission.toFixed(2)}`;
    document.getElementById('salesToday').textContent = rows.filter(r=>new Date(r.date).toDateString()===new Date().toDateString()).length;
    // determine tier by total
    let tierName='Ninguno';
    for(let i=TIERS.length-1;i>=0;i--){const t=TIERS[i]; if(total>=t.min){tierName=`Tier ${i+1}`;break}}
    document.getElementById('currentTier').textContent = tierName;

    // tiers list
    const tiersEl = document.getElementById('tiersList');
    const counts = TIERS.map(t=>({t, count: rows.filter(r=>r.price>=t.min && r.price<=t.max).length}));
    tiersEl.innerHTML = counts.map((c,i)=>`Tier ${i+1}: ${c.count} ventas`).join('<br>');
  }

  // export CSV of monthly sales
  document.getElementById('exportBtn').addEventListener('click',()=>{
    const rows = loadSales();
    if(rows.length===0){alert('No hay ventas para exportar');return}
    const csv = [['Fecha','Cliente','SKU','Producto','Precio_USD','Comision_USD','Precio_COP']]
      .concat(rows.map(r=>[r.date,r.client,r.sku,r.product,r.price,r.commission,r.priceCOP]));
    const csvStr = csv.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
    const blob = new Blob([csvStr],{type:'text/csv'}); const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download = `sales_export_${new Date().toISOString().slice(0,10)}.csv`; a.click(); URL.revokeObjectURL(url);
  });

  // currency toggle simple UI (just visual swap for labels; values stay underlying USD/COP shown in dashboard)
  document.getElementById('usdBtn').addEventListener('click',()=>{document.getElementById('usdBtn').classList.add('active');document.getElementById('copBtn').classList.remove('active');renderDashboard();});
  document.getElementById('copBtn').addEventListener('click',()=>{document.getElementById('copBtn').classList.add('active');document.getElementById('usdBtn').classList.remove('active');renderDashboard();});

  // clear notes
  document.getElementById('clearBtn').addEventListener('click',()=>{document.getElementById('callNotes').value='';document.getElementById('suggestionsBox').style.display='none'});

  // darkmode toggle (simple)
  document.getElementById('darkToggle').addEventListener('click',()=>{document.body.classList.toggle('dark');});

  // init
  renderSales(); renderDashboard();
</script>
</body>
</html>
